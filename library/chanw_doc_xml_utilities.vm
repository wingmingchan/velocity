#*doc
《code》
《copyright》
Authors: Wing Ming Chan
Copyright (c) 2017 Wing Ming Chan <chanw@upstate.edu>
MIT Licensed
Modification history:
9/28/2017 Format created.
《/copyright》
《evaluate execute=“true”》
《div id=“hide-code1”》
《h2》Test Code and Results《/h2》
《pre》
=============================================================
#import( 'core/library/velocity/chanw/chanw_library_import' )
$chanwImportDocXml
$chanwImportDatabase
$chanwImportServiceProvider
#set( $block   = $_.locateBlock( "core/base-assets/block-row", "_brisk" ) )
#chanwGetDDDocRootElement( $block )
#evaluate( $_SerializerTool.serialize( $chanwGetDDDocRootElement, true ) )
=============================================================
《/pre》
《/div》
《/evaluate》
《documentation id=“top”》
《h2》Introduction《/h2》
《p》This format provides macros to create documentation for data definitions and templates.《/p》
《/documentation》
《import》
doc*###
#import( 'core/library/velocity/chanw/chanw_initialization' )
#import( 'core/library/velocity/chanw/chanw_database_utilities' )
#import( 'core/library/velocity/chanw/chanw_service_provider' )
#*doc
《/import》
《documentation》
《code》#chanwGetDDDocRootElement( $block_chanwGetDDDocRoot )《/code》
《p》Creates a root element by processing the documentational comments in a data definition.《/p》
《/documentation》
《macro id=“chanwGetDDDocRootElement”》
doc*###
#macro( chanwGetDDDocRootElement $block_chanwGetDDDocRoot $siteName_chanwGetDDDocRoot )
    #if( !$chanwConnection || $chanwConnection.isClosed() )
        #chanwGetDatabaseStatement
    #end
    ## get the path of the data definition
    #set( $chanwDDPath = $block_chanwGetDDDocRoot.DataDefinitionPath )
    ## get the site name
    #if( $siteName_chanwGetDDDocRoot.Class.Name && $siteName_chanwGetDDDocRoot.Class.Name == $JAVA_LANG_STRING_CLASS_NAME && $siteName_chanwGetDDDocRoot.trim() != "" )
        #set( $chanwSiteName = $siteName_chanwGetDDDocRoot.trim() )
    #else
        #set( $chanwSiteName = '_brisk' )
    #end
    ## get the xml of the data definition
    #chanwGetSingleValue(
        "select xmldata from cxml_xml where id=(select xmlid from cxml_structureddatadefinition where path='$chanwDDPath' and siteid=(select id from cxml_site where name='${chanwSiteName}') and iscurrentversion=1)" )
    ## build the XML
    #chanwGetRootElementFromXml( $chanwGetSingleValue )
    #set( $chanwGetDDDocRootElement = $chanwGetRootElementFromXml )
    #chanwCleanUp
#end
#*doc
《/macro》
《documentation》
《code》#chanwGetTemplateDocRootElement( $template_chanwGetTemplateDocRootElement )《/code》
《p》Creates a root element by processing the documentational comments in a template.《/p》
《/documentation》
《macro id=“chanwGetTemplateDocRootElement”》
doc*###
#macro( chanwGetTemplateDocRootElement $template_chanwGetTemplateDocRootElement )
    #if( !$chanwConnection || $chanwConnection.isClosed() )
        #chanwGetDatabaseStatement
    #end
    ## get the path of the data definition
    #set( $chanwTemplateId = $template_chanwGetTemplateDocRootElement.Identifier.Id )
    ## get the xml of the template
    #chanwGetSingleValue(
        "select xmldata from cxml_xml where id=(select xmlid from cxml_foldercontent where id='$chanwTemplateId')" )
    ## build the XML
    #chanwGetRootElementFromXml( $chanwGetSingleValue )
    #set( $chanwGetDDDocRootElement = $chanwGetRootElementFromXml )
    #chanwCleanUp
#end
#*doc
《/macro》
《documentation》
《code》#chanwGetRootElementFromXml( $xml_chanwGetRootElementFromXml )《/code》
《p》Creates a root element by processing an xml string.《/p》
《/documentation》
《macro id=“chanwGetRootElementFromXml”》
doc*###
#macro( chanwGetRootElementFromXml $xml_chanwGetRootElementFromXml )
    #chanwBuildXMLContentRoot( $globalApacheStringUtils.substringBetween( $xml_chanwGetRootElementFromXml, '#*doc', 'doc*###' ) )
    #set( $chanwGetRootElementFromXml = $chanwBuildXMLContentRoot )
#end
#*doc
《/macro》
《documentation id=“bottom”》
《/documentation》
《/code》
doc*###