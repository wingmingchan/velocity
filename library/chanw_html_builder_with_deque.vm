#*
《code》
《copyright》
Author: Wing Ming Chan
Copyright (c) 2017 Wing Ming Chan <chanw@upstate.edu>
MIT Licensed
Modification history:
《/copyright》
《documentation id=“top”》
《h2》Introduction《/h2》
《p》This format defines an html builder using the global deque. 
The builder ensures that all tags are closed and nested properly.
It will also avoid unneccessary whitespace characters.
When using these macros, do it inside out, layer by layer.《/p》
《p》Example code:《/p》
《pre》#import( 'site://_common_assets/formats/library/velocity/chanw_html_builder_with_deque' )

## create an img element
#chanwCreateEmptyElement( { 'name':'img', 'src':'/images/photo.jpg', 'class':'img-responsive', 'alt':'Photo' } )
#set( $imgelement = $chanwCreateEmptyElement )

## wrap the img element by two div elements
#chanwCreateElementWithText( { 'name':'div', 'class':'slide' }, $imgelement )
#set( $subelement = $chanwCreateElementWithText )
#chanwCreateElementWithText( { 'name':'div', 'id':'slideshow', 'class':'col-xs-12' }, $subelement )
《/pre》
《p》This will produce:《/p》
《pre》<div id='slideshow' class='col-xs-12'><div class='slide'><img src='/images/photo.jpg' class='img-responsive' alt='Photo' /></div></div> 
《/pre》
《/documentation》
*#
#import( '/formats/library/velocity/chanw_global_values' )
#import( '/formats/library/velocity/chanw_global_deque' )
#*
《global-variables》
*#
#set( $chanwHtmlBuilderWithDequeGlobalVariables = [
    "chanwAttrs",
    "chanwCreateEmptyElement",
    "chanwElement",
    "chanwElementName",
    "chanwEmpty",
    "chanwEmptyDequeGetElement",
    "chanwEndTag",
    "chanwStartTag"
] )
#*
《/global-variables》
《documentation》
《code》#chanwCreateElementWithText( $chanwMap $chanwText )《/code》
《p》Returns an HTML element with text.《/p》
《/documentation》
《macro id=“chanwCreateElementWithText”》
*#
#macro( chanwCreateElementWithText $chanwMap $chanwText )
    #if( $chanwMap.class.name != $JAVA_UTIL_LINKEDHASHMAP_CLASS_NAME )
        A map is required.
        #stop
    #end

    #set( $chanwElementName = $chanwMap[ 'name' ] )
    
    #if( $_PropertyTool.isNull( $chanwElementName ) )
        The name cannot be null.
        #stop
    #end
    
    #set( $deque = $chanwGlobalDeque )
    #chanwAddLastGlobalDeque( $deque $chanwText ) ## put the text in first
    #chanwAddElementToGlobalDeque( $chanwMap )    ## add start and end tags
    #chanwEmptyDequeGetElement()                  ## get the string out
    #set( $chanwCreateElementWithText = $chanwEmptyDequeGetElement )
#end
#*
《/macro》
《documentation》
《code》#chanwCreateEmptyElement( $chanwMap )《/code》
《p》Returns an empty HTML element.《/p》
《/documentation》
《macro id=“chanwCreateEmptyElement”》
*#
#macro( chanwCreateEmptyElement $chanwMap )
    #if( $chanwMap.class.name != $JAVA_UTIL_LINKEDHASHMAP_CLASS_NAME )
        A map is required.
        #stop
    #end

    #set( $chanwElementName = $chanwMap[ 'name' ] )
    
    #if( $_PropertyTool.isNull( $chanwElementName ) )
        The name cannot be null.
        #stop
    #end
    
    #set( $chanwAttrs = $chanwMap.keySet() )
    #set( $chanwStartTag = "<" + $chanwMap[ 'name' ] )
    
    #foreach( $chanwAttr in $chanwAttrs )
        #if( $chanwAttrs.size() > 1 && $chanwAttr != 'name' )
            #set( $chanwStartTag = $chanwStartTag + " " + $chanwAttr + "='" + $chanwMap[ $chanwAttr ] + "'" )
        #end
    #end
    
    #set( $chanwCreateEmptyElement = $chanwStartTag + " />" )
#end
#*
《/macro》
《documentation》
《code》#chanwAddElementToGlobalDeque( $chanwMap )《/code》
《p》Creates the start tag and end tag, possibly with attributes.《/p》
《/documentation》
《macro id=“chanwAddElementToGlobalDeque”》
*#
#macro( chanwAddElementToGlobalDeque $chanwMap )
    #set( $chanwAttrs = $chanwMap.keySet() )
    #set( $chanwStartTag = "<" + $chanwMap[ 'name' ] )
    
    #foreach( $chanwAttr in $chanwAttrs )
        #if( $chanwAttrs.size() > 1 && $chanwAttr != 'name' )
            #set( $chanwStartTag = $chanwStartTag + " " + $chanwAttr + "='" + $chanwMap[ $chanwAttr ] + "'" )
        #end
    #end
    
    #set( $chanwStartTag = $chanwStartTag + ">" )
    #chanwAddFirstGlobalDeque( $deque $chanwStartTag )
    #set( $chanwEndTag = "</" + $chanwMap[ 'name' ] + ">" )
    #chanwAddLastGlobalDeque( $deque $chanwEndTag )
#end
#*
《/macro》
《documentation》
《code》#chanwEmptyDequeGetElement《/code》
《p》Empties the deque and returns the concatenated string.《/p》
《/documentation》
《macro id=“chanwEmptyDequeGetElement”》
*#
#macro( chanwEmptyDequeGetElement )
    #set( $chanwElement = "" )
    
    #foreach( $num in [1..10] ) ## assuming there are no more than ten strings
        #chanwEmptyGlobalDeque( $deque )
        #set( $chanwEmpty = $chanwEmptyGlobalDeque )
        
        #if( !$chanwEmpty )
            #chanwTakeFirstGlobalDeque( $deque )
            #set( $chanwElement = $chanwElement + $chanwTakeFirstGlobalDeque )
        #else
            #break
        #end
    #end
    #set( $chanwEmptyDequeGetElement = $chanwElement )
#end
#*
《/macro》
《documentation id=“bottom”》
《/documentation》
《/code》
*#