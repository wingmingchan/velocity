#*
This format provides utility macros for reflection.

Example:
#chanwDisplayClassAPI( "java.lang.Math", "h3", "true" ) ## pass in a class name
#chanwDisplayClassAPI( $_, "h3", "true" )               ## pass in an object
#chanwDisplayClassAPI( $_.Class, "h3", "true" )         ## pass in a java.lang.Class object
*#
#import( '/formats/library/velocity/chanw_object_creator' )

#macro( chanwDisplayClassAPI $obj $heading $withH2 )
    #if( $_PropertyTool.isNull( $obj ) )
        No parameter supplied.
        #stop
    #end
    #chanwDisplayObjClassName( $obj $withH2 )
    #chanwDisplaySuperClass( $obj $heading )
    #chanwDisplayFields( $obj $heading )
    #chanwDisplayConstructors( $obj $heading )
    #chanwDisplayMethods( $obj $heading )
    $HR
#end

#macro( chanwDisplayObjClassName $obj $withH2 )
    #set( $objString = "" )
    #set( $objType = $obj.Class.Name )
    
    #if( $objType == $JAVA_LANG_STRING_CLASS_NAME )    ## class name
        #set( $objString = $obj )
    #elseif( $objType == $JAVA_LANG_CLASS_CLASS_NAME ) ## class obj
        #set( $objString = $obj.Name )
    #else                                              ## obj of other types
        #set( $objString = $obj.Class.Name )
    #end
    
    #if( $withH2 )<h2>$objString</h2>#end
#end

#macro( chanwDisplayConstructors $obj $heading )
    #set( $objType = $obj.Class.Name )
    
    #if( $objType == $JAVA_LANG_STRING_CLASS_NAME )    ## class name
        #set( $chanwClassObj = $_PropertyTool.class.forName( $obj ) )
    #elseif( $objType == $JAVA_LANG_CLASS_CLASS_NAME ) ## class obj
        #set( $chanwClassObj = $obj )
    #else                                              ## obj of other types
        #set( $chanwClassObj = $obj.Class )
    #end
    
    #if( $chanwClassObj )
        #set( $constructors = $chanwClassObj.getConstructors() )
        
        #if( $constructors && $constructors.size() > 0 )
            <$heading>Constructors</$heading>
            <ul>
            #foreach( $constructor in $constructors )
                <li>## print modifiers
                $_.class.forName( "java.lang.reflect.Modifier" ).getMethod( 
                    "toString", $_FieldTool.in( 
                    "java.lang.Integer" ).TYPE ).invoke( 
                    null, $constructor.getModifiers() )
                ${constructor.Name}##
                    
                #set( $paramTypes = $constructor.getParameterTypes() )
                #set( $paramString = "( " )
                
                #if( $paramTypes && $paramTypes.size() > 0 )
                    #foreach( $paramType in $paramTypes )
                        #set( $paramString = $paramString + $paramType.toString() )
                        
                        #if( $foreach.count < $paramTypes.size() )
                            #set( $paramString = $paramString + ", " )
                        #end
                    #end
                #end
                
                #set( $paramString = $paramString + " )" )
                #set( $paramString = $paramString.trim() )$paramString</li>
            #end
            </ul>
        #else
            ## No constructors found.
        #end
    #else
        ## No constructors found.
    #end
#end

#macro( chanwDisplayMethods $obj $heading )
    #set( $objType = $obj.Class.Name )
    
    #if( $objType == $JAVA_LANG_STRING_CLASS_NAME )    ## class name
        #set( $chanwClassObj = $_PropertyTool.class.forName( $obj ) )
    #elseif( $objType == $JAVA_LANG_CLASS_CLASS_NAME ) ## class obj
        #set( $chanwClassObj = $obj )
    #else                                              ## obj of other types
        #set( $chanwClassObj = $obj.Class )
    #end
    
    #if( $chanwClassObj )
        #set( $methods = $chanwClassObj.getDeclaredMethods() )
        
        #if( $methods && $methods.size() > 0 )
            <$heading>Methods</$heading>
            <ul>
            #foreach( $method in $methods )
                <li>
                $_.class.forName( "java.lang.reflect.Modifier" ).getMethod( 
                    "toString", $_FieldTool.in( 
                    "java.lang.Integer" ).TYPE ).invoke( 
                    null, $method.getModifiers() )&#160;
                    
                    #set( $chanwReturnType = $method.getGenericReturnType().getTypeName().replaceAll( "<", "&lt;" ) )
                    $chanwReturnType
                    $method.Name
                    #set( $chanwParamTypes = $method.getGenericParameterTypes() )
                    #set( $paramTypesString = "( " )
                    
                    #if( $chanwParamTypes && $chanwParamTypes.size() > 0 )
                        #foreach( $chanwParamType in $chanwParamTypes )
                        
                            
                        
                            #if( $chanwParamType.Name )
                                #set( $paramTypesString = $paramTypesString + $chanwParamType.Name )
                            #elseif( $chanwParamType.getTypeName() )
                                #set( $paramTypesString = $paramTypesString + $chanwParamType.getTypeName().replaceAll( "<", "&lt;" ) )
                            #end
                            
                            #if( $foreach.count < $chanwParamTypes.size() )
                                #set( $paramTypesString = $paramTypesString + ", " )
                            #end
                        #end
                    #end
                    #set( $paramTypesString = $paramTypesString + " )" )
                    #set( $paramTypesString = $paramTypesString.trim() )
                    $paramTypesString
                    #set( $annotatedReturnType = $method.getAnnotatedReturnType() )
                    
                </li>
            #end
            </ul>
        #else
            ## No methods.
        #end
    #end
#end

#macro( chanwDisplayFields $obj $heading )
    #set( $objType = $obj.Class.Name )
    
    #if( $objType == $JAVA_LANG_STRING_CLASS_NAME )    ## class name
        #set( $chanwClassObj = $_PropertyTool.class.forName( $obj ) )
    #elseif( $objType == $JAVA_LANG_CLASS_CLASS_NAME ) ## class obj
        #set( $chanwClassObj = $obj )
    #else                                              ## obj of other types
        #set( $chanwClassObj = $obj.Class )
    #end
    
    #if( $chanwClassObj )
        #set( $fields = $chanwClassObj.getFields() )
        
        #if( $fields && $fields.size() > 0 )
            <$heading>Fields</$heading>
            <ul>
            #foreach( $field in $fields )
                <li>$field.getName(): $field.get( null )</li>
            #end
            </ul>
        #else
            ## No fields.
        #end
    #end
#end

#macro( chanwDisplaySuperClass $obj $heading )
    #set( $objType = $obj.Class.Name )
    
    #if( $objType == $JAVA_LANG_STRING_CLASS_NAME )    ## class name
        #set( $chanwClassObj = $_PropertyTool.class.forName( $obj ) )
    #elseif( $objType == $JAVA_LANG_CLASS_CLASS_NAME ) ## class obj
        #set( $chanwClassObj = $obj )
    #else                                              ## obj of other types
        #set( $chanwClassObj = $obj.Class )
    #end
    
    #if( $chanwClassObj )
        #set( $parent = $chanwClassObj.getGenericSuperclass() )
        
        #if( $parent )
        <$heading>Parent Class</$heading><p>$parent.toString()</p>
        #end
    #end
#end